function I(){const i=document.querySelector(".toc-wrapper"),e=document.querySelector(".sidebar-only-wrapper");i?.querySelector(".table-of-contents")?(i&&(i.style.display="block"),e&&(e.style.display="none"),A()):(i&&(i.style.display="none"),e&&(e.style.display="block"))}function A(){const i=document.querySelector(".toc-scroll-wrapper"),e=document.querySelector(".sidebar-wrapper");if(!i||!e)return;const t=window.innerHeight-40,c=i.scrollHeight,o=t*.625,l=Math.min(c,o),f=t-l-20;e.style.maxHeight=`${f}px`}document.addEventListener("DOMContentLoaded",()=>{I(),setTimeout(I,500),setTimeout(I,1e3)});(document.readyState==="complete"||document.readyState==="interactive")&&(I(),setTimeout(I,500),setTimeout(I,1e3));window.addEventListener("resize",()=>{document.querySelector(".toc-wrapper .table-of-contents")&&A()});function z(){document.querySelectorAll(".code-block-copy-button").forEach(e=>{e.addEventListener("click",async()=>{const t=e.closest(".code-block-wrapper");if(!t)return;let c="";const o=t.querySelector(".shiki code");if(o){const l=[],y=document.createTreeWalker(o,NodeFilter.SHOW_TEXT,null);let f;for(;f=y.nextNode();)f.textContent&&l.push(f.textContent);c=l.join(""),c||(c=o.innerText||"")}else{const l=t.querySelector("pre code")||t.querySelector("code");l&&(c=l.innerText||l.textContent||"")}try{await navigator.clipboard.writeText(c),e.classList.add("copied"),setTimeout(()=>{e.classList.remove("copied")},1500)}catch(l){console.error("コピーに失敗しました:",l)}})})}function N(){const i=document.querySelectorAll(".code-block-wrap-button");console.log("折り返しボタンの数:",i.length),i.forEach(e=>{const t=e.closest(".code-block-wrapper");if(!t){console.log("ラッパーが見つかりません");return}const c=t.querySelector(".shiki")||t.querySelector("pre:not(.shiki)");if(c){const o=c.scrollWidth>c.clientWidth;if(console.log("横スクロールチェック:",{scrollWidth:c.scrollWidth,clientWidth:c.clientWidth,hasHorizontalScroll:o}),!o){e.style.display="none";return}}else console.log("コード要素が見つかりません");e.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),console.log("折り返しボタンがクリックされました"),t.classList.toggle("wrapped"),e.classList.toggle("active"),console.log("wrappedクラス:",t.classList.contains("wrapped")),console.log("activeクラス:",e.classList.contains("active"))})})}function M(){console.log("コードブロックを初期化中..."),z(),N()}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",M):M();setTimeout(M,100);setTimeout(M,500);function g(){const i=document.getElementById("mobile-menu-button"),e=document.getElementById("mobile-menu-overlay"),t=document.getElementById("mobile-menu-header-close"),c=document.getElementById("mobile-toc-button"),o=document.getElementById("mobile-toc-content"),l=document.getElementById("mobile-toc-icon"),y=document.getElementById("mobile-header-spacer"),f=document.querySelector("header.lg\\:hidden");if(!i||!e||!t||!c||!o||!l)return;const a=()=>{if(f&&y&&o){const r=f.offsetHeight;y.style.height=`${r}px`,o.style.top=`${r}px`}};a(),window.addEventListener("resize",a);const k=()=>{e.classList.add("hidden"),document.body.style.overflow=""};i.addEventListener("click",()=>{e.classList.remove("hidden"),document.body.style.overflow="hidden"}),t.addEventListener("click",k),e.addEventListener("click",r=>{r.target===e&&k()}),document.addEventListener("keydown",r=>{r.key==="Escape"&&!e.classList.contains("hidden")&&k()});let m=null;const H=()=>{if(m=document.querySelector(".toc-scroll-wrapper .table-of-contents"),!m){const h=document.querySelector('slot[name="toc"]');if(h){const L=h.assignedNodes();for(const E of L)if(E.nodeType===Node.ELEMENT_NODE){const w=E.querySelector(".table-of-contents");if(w){m=w;break}}}}if(m||(m=document.querySelector(".table-of-contents")),!m)return c.classList.add("hidden"),!1;const r=m.querySelector(".table-of-contents-list");return r&&r.children.length===0?(c.classList.add("hidden"),!1):(c.classList.remove("hidden"),!0)},b=new MutationObserver(()=>{m||H()}),p=document.querySelector(".toc-wrapper");p&&b.observe(p,{childList:!0,subtree:!0}),H();const v=()=>{if(!m&&!H()||(o.classList.remove("hidden"),l.textContent="∧",o.children.length>0))return;const r=m.cloneNode(!0),h=r.querySelector(".table-of-contents-header");h&&h.remove(),o.innerHTML="",o.appendChild(r);const L=document.querySelector("header.lg\\:hidden"),E=L?L.offsetHeight:48,w=o.querySelectorAll(".table-of-contents-link");w.forEach(S=>{S.addEventListener("click",n=>{n.preventDefault();const s=S.getAttribute("href");if(s&&s.startsWith("#")){const u=s.substring(1),d=document.getElementById(u);if(d){const T=100+E,x=d.getBoundingClientRect().top+window.pageYOffset-T;window.scrollTo({top:x,behavior:"smooth"})}}B()})}),(()=>{const S={root:null,rootMargin:"-20% 0px -70% 0px",threshold:0},n=u=>{u.forEach(d=>{if(d.isIntersecting){const T=d.target.id;o.querySelectorAll(".table-of-contents-link").forEach(x=>{const O=x.closest(".table-of-contents-item");x.getAttribute("href")===`#${T}`?O?.classList.add("table-of-contents-item-active"):O?.classList.remove("table-of-contents-item-active")})}})},s=new IntersectionObserver(n,S);return w.forEach(u=>{const d=u.getAttribute("href");if(d&&d.startsWith("#")){const T=d.substring(1),C=document.getElementById(T);C&&s.observe(C)}}),()=>s.disconnect()})()},B=()=>{o.classList.add("hidden"),l.textContent="∨"};c.addEventListener("click",()=>{o.classList.contains("hidden")?v():B()}),document.addEventListener("click",r=>{if(!o.classList.contains("hidden")){const h=r.target;!o.contains(h)&&!c.contains(h)&&B()}})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{g(),setTimeout(g,100),setTimeout(g,500),setTimeout(g,1e3),setTimeout(g,2e3)}):(g(),setTimeout(g,100),setTimeout(g,500),setTimeout(g,1e3),setTimeout(g,2e3));function W(){const i=document.getElementById("image-modal"),e=document.getElementById("image-modal-img"),t=document.getElementById("image-modal-container"),c=document.getElementById("image-modal-wrapper"),o=document.getElementById("image-modal-close"),l=document.getElementById("image-modal-zoom-in"),y=document.getElementById("image-modal-zoom-out"),f=document.getElementById("image-modal-reset");if(!i||!e||!t||!c||!o||!l||!y||!f)return;let a=1;const k=.5,m=5,H=.25;let b=0,p=0;const v=()=>{if(e.style.transform=`scale(${a})`,b>0&&p>0){const n=b*a,s=p*a;c.style.minWidth=`${n}px`,c.style.minHeight=`${s}px`}setTimeout(()=>{const n=t.clientWidth,s=t.clientHeight,u=(t.scrollWidth-n)/2,d=(t.scrollHeight-s)/2;t.scrollTo({left:u,top:d,behavior:"smooth"})},50)},B=()=>{a<m&&(a=Math.min(a+H,m),v())},r=()=>{a>k&&(a=Math.max(a-H,k),v())},h=()=>{if(b===0||p===0)return 1;const n=window.innerWidth*.9,s=window.innerHeight*.9,u=n/b,d=s/p,T=Math.min(u,d);return Math.min(T,2)},L=()=>{setTimeout(()=>{const n=t.clientWidth,s=t.clientHeight,u=(t.scrollWidth-n)/2,d=(t.scrollHeight-s)/2;t.scrollTo({left:u,top:d,behavior:"smooth"})},100)},E=()=>{a=h(),v(),L()},w=(n,s)=>{e.setAttribute("src",n),e.setAttribute("alt",s),e.onload=()=>{b=e.naturalWidth,p=e.naturalHeight,a=h(),v(),L()},i.classList.remove("hidden"),document.body.style.overflow="hidden"},q=()=>{i.classList.add("hidden"),document.body.style.overflow="",E()},S=document.querySelector(".markdown-content");S&&S.querySelectorAll("img").forEach(s=>{s.style.cursor="pointer",s.addEventListener("click",()=>{const u=s.getAttribute("src")||"",d=s.getAttribute("alt")||"";w(u,d)})}),o.addEventListener("click",q),l.addEventListener("click",B),y.addEventListener("click",r),f.addEventListener("click",E),window.addEventListener("resize",()=>{if(!i.classList.contains("hidden")&&b>0&&p>0){const n=h();Math.abs(a-n)<.01&&(a=n,v())}}),t.addEventListener("wheel",n=>{(n.ctrlKey||n.metaKey)&&(n.preventDefault(),n.deltaY<0?B():r())}),i.addEventListener("click",n=>{const s=n.target;(s===i||s===t||s===c)&&q()}),e.addEventListener("click",n=>{n.stopPropagation()}),document.addEventListener("keydown",n=>{n.key==="Escape"&&!i.classList.contains("hidden")&&q()})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{W(),setTimeout(W,100),setTimeout(W,500)}):(W(),setTimeout(W,100),setTimeout(W,500));
